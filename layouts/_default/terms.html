{{- define "main" }}

{{- if .Title }}
<header class="page-header">
    {{- if eq .Title "Categories" }}
    <h1>ðŸ§©{{ .Title }}</h1>
    {{- end }}
    {{- if eq .Title "Tags" }}
    <h1>ðŸ§©{{ "æ ‡ç­¾" }}</h1>
    <!-- <h1>ðŸ”–{{ .Title }}</h1> -->
    {{- end }}
    <!-- <h1>{{ .Title }}</h1> -->
    {{- if .Description }}
    <div class="post-description">
        {{ .Description }}
    </div>
    {{- end }}
</header>
{{- end }}


<!--æ ‡ç­¾äº‘-->

<div id="sourrounding_div" style="width:100%;height:100%;min-height: 500px;">
    <div id="tag-canvas"></div>
</div>

<script src="../../assets/js/wordcloud2.js"></script>

{{- range $key, $value := .Data.Terms.Alphabetical }}
    {{ if eq "" ($.Scratch.Get "tagsMap") }}
        {{ $.Scratch.Set "tagsMap" (slice (dict .Name .Count))  }}
    {{ else }}
        {{ $.Scratch.Add "tagsMap" (slice (dict .Name .Count)) }}
    {{ end }}
{{- end }}
{{ $result := ($.Scratch.Get "tagsMap")}}
`<span id="tag-temp" style="display:none">`{{$result | jsonify }}

<script>
    //å› ä¸ºå‰æœŸæ¯ä¸ªæ ‡ç­¾å€¼æ¯”è¾ƒå°ï¼Œå¸®Xä¸€ä¸ªç³»æ•°
    var XISHU = 20;
    //ä¸ºäº†åŠ¨æ€å®½åº¦
    var div = document.querySelector("#sourrounding_div");
    var canvas = document.querySelector("#tag-canvas");
    canvas.style.width = div.offsetWidth+'px';
    canvas.style.height = div.offsetHeight+'px';
    var wordFreqData =  document.querySelector("#tag-temp").innerHTML;
    var jsonObj = JSON.parse(wordFreqData);
    var arr = []
    jsonObj.forEach(element => {
        var key = Object.keys(element);
        var itemArr = [key[0],element[key]*XISHU];
        arr.push(itemArr);
    });
    //èŽ·å–å½“å‰æ˜¯æš—è‰²è¿˜æ˜¯æµ…è‰²
    var isDark = document.body.className.includes("dark");
    WordCloud(canvas, {
          "list": arr,//æˆ–è€…[['å„ä½è§‚ä¼—',45],['è¯äº‘', 21],['æ¥å•¦!!!',13]],åªè¦æ ¼å¼æ»¡è¶³è¿™æ ·éƒ½å¯ä»¥
          "shape": "pentagon", //å½¢çŠ¶ circle (default), cardioid (å¿ƒåž‹), diamond, square, triangle-forward, triangle, pentagon, and star.
          "gridSize": 6, // å¯†é›†ç¨‹åº¦ æ•°å­—è¶Šå°è¶Šå¯†é›†
          "weightFactor": 1, // å­—ä½“å¤§å°=åŽŸå§‹å¤§å°*weightFactor
          "fontWeight": 'normal', //å­—ä½“ç²—ç»†
          "fontFamily": 'Times, serif', // å­—ä½“
          "color": isDark?'random-light':'random-dark', // å­—ä½“é¢œè‰² 'random-dark' æˆ–è€… 'random-light'
          "backgroundColor": 'transparent', // èƒŒæ™¯é¢œè‰²
          "classes": "tag-cloud-item word-color", //ç”¨äºŽç‚¹å‡»äº‹ä»¶
      });
      canvas.addEventListener('wordcloudstop', function (e) {
            //åŠ¨ç”»
            setTimeout(() => {
                var els = document.querySelectorAll(".word-color");
                Array.from(els).forEach((el) => {
                    console.log('åŠ¨ç”»',el)
                    el.classList.add("word-animate")
                })
            }, 2000);
            //ç‚¹å‡»
            document.querySelectorAll('.tag-cloud-item').forEach(function (element) {
                const text = element.innerHTML;
                element.innerHTML = `<a href="/tags/${text}" style="color: inherit;">${text}</a>`;
            });
        });
  
</script>

<!-- <ul class="terms-tags">
    {{- $type := .Type }}
    {{- range $key, $value := .Data.Terms.Alphabetical }}
    {{- $name := .Name }}
    {{- $count := .Count }}
    {{- with site.GetPage (printf "/%s/%s" $type $name) }}
    <li>
        <a href="{{ .Permalink }}">{{ .Name }} <sup><strong><sup>{{ $count }}</sup></strong></sup> </a>
    </li>
    {{- end }}
    {{- end }}
</ul> -->


{{- end }}{{/* end main */ -}}